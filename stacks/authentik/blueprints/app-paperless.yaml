version: 1

metadata:
  name: App - Paperless

entries:

  - model: authentik_providers_oauth2.oauth2provider
    id: paperless
    identifiers:
      name: Provider for Paperless
    attrs:
      authorization_flow: !Find [authentik_flows.flow, [slug, default-provider-authorization-implicit-consent]]
      invalidation_flow: !Find [authentik_flows.flow, [slug, default-provider-invalidation-flow]]
      client_id: !File /run/secrets/paperless-client-id
      client_secret: !File /run/secrets/paperless-client-secret
      redirect_uris:
        - matching_mode: strict
          url: https://paperless.lab.omglolwtfbbq.com/accounts/oidc/authentik/login/callback/
      signing_key: !Find [authentik_crypto.certificatekeypair, [name, authentik Self-signed Certificate]]
      sub_mode: user_username
      access_token_validity: "minutes=5"
      property_mappings:
        - !Find [authentik_providers_oauth2.scopemapping, [managed, goauthentik.io/providers/oauth2/scope-openid]]
        - !Find [authentik_providers_oauth2.scopemapping, [managed, goauthentik.io/providers/oauth2/scope-email]]
        - !Find [authentik_providers_oauth2.scopemapping, [managed, goauthentik.io/providers/oauth2/scope-profile]]

  - model: authentik_core.application
    identifiers:
      slug: paperless
    attrs:
      name: Paperless
      provider: !KeyOf paperless
      open_in_new_tab: true
      meta_launch_url: https://paperless.lab.omglolwtfbbq.com/
